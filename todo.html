<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>

<body>
    <div id="container"></div>

    <script src="/helper.js"></script>
    <script>
        const TASK_CREATED = 'TASK_CREATED'

        const initialStore = {
            tasks: []
        };

        // Task Component

        const Task = (task) =>
            Div([
                H4([task.title])
            ]);

        // TaskList Component

        const TaskList = (tasks) =>
            Div(tasks.map(Task));

        // NewTask Component

        const NewTask = (dispatch) => (newTask) =>
            Form([
                Input([newTask.title], { type: 'text', name: 'title' }),
                Button(['Create'])
            ], { onsubmit: dispatchFormData(dispatch, TASK_CREATED) });

        // Todo Component

        const Todo = (dispatch) => (store) =>
            Div([
                NewTask((a, p) => dispatch(a, p, store))(store.newTask || {}),
                TaskList(store.tasks)
            ]);

        // Todo Actions Handler

        TodoActions = (dispatch) => (action, payload, store) => {
            switch (action) {
                case TASK_CREATED:
                    dispatch({ tasks: [payload, ...store.tasks] });
                    break;
            }
        };

        // Todo App

        const TodoApp = (renderer) => Todo(TodoActions(renderer));

        // Entrypoint

        const main = (store) => {
            const tasksList = TodoApp(main)(store);
            render(tasksList); // <-- side-effect
        }

        main(initialStore);
    </script>
</body>

</html>