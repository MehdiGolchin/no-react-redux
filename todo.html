<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>

<body>
    <div id="container"></div>

    <script src="/helper.js"></script>
    <script>
        const TASK_CREATED = 'TASK_CREATED';
        const TASK_REMOVED = 'TASK_REMOVED';

        const initialStore = {
            tasks: []
        };

        // Task Component

        const Task = (dispatch) => (task) =>
            Div([
                H4([task.title]),
                Button(['Remove'], { onclick: () => dispatch(TASK_REMOVED, task) })
            ]);

        // TaskList Component

        const TaskList = (dispatch) => (tasks) =>
            Div(tasks.map(Task(dispatch)));

        // NewTask Component

        const NewTask = (dispatch) => () =>
            DispatchForm([
                Input([], { type: 'text', name: 'title' }),
                Button(['Create'])
            ], {}, dispatch, TASK_CREATED);

        // Todo Component

        const Todo = (dispatch) => (store) =>
            Div([
                NewTask(includeParams(dispatch, store))(),
                TaskList(includeParams(dispatch, store))(store.tasks)
            ]);

        // Todo Actions Handler

        TodoActions = (dispatch) => (action, payload, store, ...args) => {
            switch (action) {
                case TASK_CREATED:
                    dispatch({ tasks: [...store.tasks, payload] });
                    break;
                case TASK_REMOVED:
                    dispatch({ tasks: [ ...store.tasks.filter(e => e !== payload) ] });
                    break;
            }
        };

        // Todo App

        const TodoApp = (renderer) => Todo(TodoActions(renderer));

        // Entrypoint

        const main = (store) => {
            const tasksList = TodoApp(main)(store);
            render(tasksList); // <-- side-effect
        }

        main(initialStore);
    </script>
</body>

</html>